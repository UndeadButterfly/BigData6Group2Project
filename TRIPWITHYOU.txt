DROP DATABASE TRIPWITHYOU;
CREATE DATABASE TRIPWITHYOU
DEFAULT CHARACTER SET UTF8 COLLATE UTF8_GENERAL_CI;

USE TRIPWITHYOU;

CREATE TABLE user(
user_id VARCHAR(50) NOT NULL,
pw VARCHAR(50) NOT NULL,
name VARCHAR(10) NOT NULL,
birth DATE,
phone VARCHAR(12),
gender INT(1) NOT NULL,
email VARCHAR(30),
signup DATETIME DEFAULT NOW(),
login DATETIME,
loc VARCHAR(30) DEFAULT 0,
hobby INT(1) DEFAULT 1,
u_type INT(1),
reports INT,
login_state INT(1),
PRIMARY KEY(user_id),
UNIQUE KEY (phone, email)
);

CREATE TABLE COURSE (
course_no INT(8) NOT NULL,
user_id VARCHAR(50) NOT NULL,
ctitle VARCHAR(30) NOT NULL,
cdestination VARCHAR(30) NOT NULL,
cstart DATE NOT NULL,
cend DATE NOT NULL,
cduration INT(3) NOT NULL,
ctransport INT(1),
cmember INT(2) NOT NULL,
cbudget INT(255),
PRIMARY KEY(course_no),
FOREIGN KEY(user_id) REFERENCES USER(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE UPLOAD (
upload_no int(8),
uptype int(2),
user_id varchar(50),
title varchar(40) NOT NULL,
contents longtext,
views int(8) NOT NULL DEFAULT 0,
likes int(8) NOT NULL DEFAULT 0,
hates int(8) NOT NULL DEFAULT 0,
reports int(2) NOT NULL DEFAULT 0,
upstate int(1),
CONSTRAINT PK_upload PRIMARY KEY(upload_no) ,
CONSTRAINT FK_uploadUser FOREIGN KEY (user_id) REFERENCES user(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE EMP (
empno INT(8),
user_id VARCHAR(50) NOT NULL,
hiredate DATE,
PRIMARY KEY(empno),
FOREIGN KEY(user_id) REFERENCES USER(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE RELATION (
subject_id VARCHAR(50),
relation INT(1),
user_id VARCHAR(50),
rel_memo VARCHAR(255),
relation_no VARCHAR(50),
PRIMARY KEY(subject_id),
FOREIGN KEY(user_id) REFERENCES USER(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE upload_img (
upload_img_no INT(8),
upload_no INT(8),
img_path VARCHAR(255),
CONSTRAINT PK_board PRIMARY KEY(upload_img_no),
CONSTRAINT FK_boardUpload FOREIGN KEY(upload_no)
REFERENCES upload(upload_no)
ON UPDATE CASCADE ON DELETE CASCADE
);

create table matching(
upload_no int(8),
user_id varchar(50),
trip_no int(8),
arrival varchar(50),
tstart date,
tend date,
tduration int(3),
tmember int(2),
primary key (tmember),
foreign key(user_id) references user(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE FAVORITE (
favorite_no INT(8),
user_id VARCHAR(50),
course_no INT(8),
PRIMARY KEY(favorite_no),
FOREIGN KEY(user_id) REFERENCES USER(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE REPLY (
reply_no int(8),
upload_no int(8),
user_id varchar(50),
rcontent mediumtext NOT NULL,
rdate DATETIME DEFAULT NOW(),
CONSTRAINT  PK_reply PRIMARY KEY (reply_no),
CONSTRAINT FK_replyuploads FOREIGN KEY (upload_no)
REFERENCES upload (upload_no)
ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FK_replyuser FOREIGN KEY (user_id)
REFERENCES user(user_id)
ON UPDATE CASCADE ON DELETE  CASCADE
);

CREATE TABLE PLACE(
place_no VARCHAR(50),
course_no INT(8),
place_pday INT(2),
place_porder INT(2),
primary key(place_no),
CONSTRAINT FK_palceCourse FOREIGN KEY (course_no)
REFERENCES course(course_no)
ON UPDATE CASCADE ON DELETE CASCADE
);