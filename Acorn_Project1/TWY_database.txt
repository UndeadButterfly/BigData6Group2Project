DROP DATABASE TRIPWITHYOU;
CREATE DATABASE TRIPWITHYOU
DEFUALT CHARACTER SET utf8 COLLATE utf8_general_ci;

use TRIPWITHYOU;

CREATE TABLE USER
(
    user_id VARCHAR(50),
    user_pw VARCHAR(50) NOT NULL,
    uname VARCHAR(10) NOT NULL,
    ubirth DATE,
    uphone VARCHAR(12),
    ugender INT(1) NOT NULL,
    uemail VARCHAR(30),
    usignup DATETIME DEFAULT NOW(),
    ulogin DATETIME,
    uloc VARCHAR(30) DEFAULT 0,
    uhobby INT(1) DEFAULT 1,
    umbti VARCHAR(6) DEFAULT 'ISTJ',
    ublood VARCHAR(3) DEFAULT 'AB+',
    utype INT(1),
    CONSTRAINT PK_User PRIMARY KEY(user_id),
    CONSTRAINT UK_User UNIQUE KEY (uphone,uemail)
	);

CREATE TABLE COURSE (
	course_no INT(8),
	user_id VARCHAR(50) NOT NULL,
	ctitle VARCHAR(30) NOT NULL,
	cstart DATE NOT NULL,
	cend DATE NOT NULL,
	cduration INT(3) NOT NULL,
	ctransport INT(1),
	cmember INT(2) NOT NULL,
	cbudget INT(255),
	CONSTRAINT PK_Course PRIMARY KEY(course_no),
	CONSTRAINT FK_courseUser FOREIGN KEY(user_id) REFERENCES USER(user_id)
    ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE UPLOAD (
upload_no int(8),
upkind int(2),
user_id varchar(50),
uptitle varchar(40) NOT NULL,
upcontents longtext,
upviews int(8) NOT NULL DEFAULT 0,
uplikes int(8) NOT NULL DEFAULT 0,
updislikes int(8) NOT NULL DEFAULT 0,
upreports int(2) NOT NULL DEFAULT 0,
upstate int(1),
CONSTRAINT PK_upload PRIMARY KEY(upload_no) ,
CONSTRAINT FK_uploadUser FOREIGN KEY (user_id) REFERENCES USER(user_id) 
ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE EMP (
 empno INT(8),
 user_id VARCHAR(50) NOT NULL,
 estate INT(1),
 ehiredate DATE,
CONSTRAINT PK_EMP PRIMARY KEY(empno),
CONSTRAINT FK_EMPUSER FOREIGN KEY(user_id) REFERENCES USER(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE RELATION (
 subject_id VARCHAR(50),
 relation INT(1),
 login_state INT(1),
 user_id VARCHAR(50),
 rel_memo VARCHAR(255),
 target_id VARCHAR(50),
 CONSTRAINT PK_RELATION PRIMARY KEY(subject_id),
CONSTRAINT FK_RELATIONUSER FOREIGN KEY(user_id) REFERENCES USER(user_id),
FOREIGN KEY(target_id) REFERENCES USER(user_id),
CONSTRAINT FK_RELATIONTARGET FOREIGN KEY(target_id) REFERENCES USER(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
);

create table board(
upload_no int(8),
board_no int(8),
battatch blob null,
CONSTRAINT PK_BOARD primary key(board_no),
CONSTRAINT FK_foreign key(upload_no) references 
board(upload_no) on update cascade on delete cascade;
);

create table match(
upload_no int(8),
trip_no int(8),
tdestination varchar(50),
tstart date,
tend date,
tmember int(2),
primary key (tmember),
foreign key(upload_no) references user(user_id)
ON UPDATE CASCADE ON DELETE CASCADE;
);

CREATE TABLE FAVORITE (
favorite_no INT(8),
user_id VARCHAR(50),       
course_no INT(8),
PRIMARY KEY(favorite_no),
FOREIGN KEY(user_id) REFERENCES USER(user_id),
FOREIGN KEY(course_no) REFERENCES USER(user_id)
ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE REPLY (
reply_no int(8),
upload_no int(8),
user_id varchar(50),
rcontent mediumtext NOT NULL,
rdate DATETIME DEFAULT NOW(),
CONSTRAINT  PK_reply PRIMARY KEY (reply_no),
CONSTRAINT FK_replyuploads FOREIGN KEY (upload_no) 
REFERENCES upload (upload_no)
ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT FK_replyuser FOREIGN KEY (user_id)
REFERENCES user(user_id) 
ON UPDATE CASCADE ON DELETE  CASCADE
);

CREATE TABLE PLACE(
place_no VARCHAR(50),
place_course_no INT(8),
place_tour_id VARCHAR(12),
place_pday INT(2), 
place_porder INT(2),
primary key(place_no)
);
